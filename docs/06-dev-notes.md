# 개발 구현 노트

## 기술 스택
- **Framework**: Next.js 16.1.6 (App Router)
- **UI Library**: React 19.2.3
- **Language**: TypeScript 5
- **Styling**: Tailwind CSS v4 (`@tailwindcss/postcss`)
- **State Management**: React Context + useReducer
- **Persistence**: localStorage (key: `hero-mom-save`)
- **Backend**: 없음 (완전 클라이언트 사이드)

## 실행 방법
```bash
cd hero-mom/prototype
npm install
npm run dev
```
개발 서버가 `localhost:3000`에서 실행된다.

## 프로젝트 구조
```
prototype/src/
├── app/                    # Next.js App Router (layout, page)
├── components/
│   ├── game/               # 게임 화면 컴포넌트
│   │   ├── HomePage.tsx        # 집 화면 (아들 상태, 식탁/포션/장비/책 배치)
│   │   ├── AdventurePanel.tsx  # 모험 진행 중 편지 표시
│   │   ├── ReturnModal.tsx     # 모험 귀환 결과 모달
│   │   ├── FarmPage.tsx        # 농장 (심기/수확)
│   │   ├── KitchenPage.tsx     # 주방 (요리)
│   │   ├── BlacksmithPage.tsx  # 대장간 (장비 제작/강화/가챠)
│   │   ├── AlchemyPage.tsx     # 연금술 (포션 제조)
│   │   └── InventoryModal.tsx  # 인벤토리 모달
│   └── ui/                 # 공통 UI 컴포넌트
│       ├── GameLayout.tsx      # 전체 레이아웃 + 페이지 라우팅
│       ├── BottomNav.tsx       # 하단 탭 네비게이션
│       ├── StatusBar.tsx       # 상단 상태바 (재화, 레벨)
│       ├── ProgressBar.tsx     # 프로그레스 바
│       ├── ItemSlot.tsx        # 아이템 슬롯
│       ├── Modal.tsx           # 범용 모달
│       └── Toast.tsx           # 토스트 알림
├── lib/
│   ├── types.ts            # 전체 타입 정의
│   ├── constants.ts        # 상수, 레시피, 데이터 테이블
│   ├── gameState.tsx       # Context Provider, Reducer, 저장/로드
│   └── game/               # 게임 로직 모듈
│       ├── sonAI.ts            # 아들 AI 행동 결정 트리
│       ├── adventure.ts        # 모험 시스템 (출발/전투/편지/귀환)
│       ├── crafting.ts         # 제작 시스템 (장비/요리/포션/강화/가챠)
│       └── farm.ts             # 농장 시스템 (심기/성장/수확)
└── hooks/                  # (예약됨)
```

## 구현 현황

### 코어 게임
- [x] **아들 AI 행동 시스템**: 2초 틱마다 상태 기반 행동 결정 트리 실행 (배고픔 감소, 식사, 수면, 훈련, 독서, 휴식, 포션 음용, 출발)
- [x] **모험 시스템**: 레벨 기반 모험 시간/전투 횟수 결정, 전투력 계산(스탯+장비+버프), 전투 결과 4단계(압도적/승리/신승/패배)
- [x] **편지 시스템**: 모험 중 30~60초 간격으로 상황 편지 수신
- [x] **귀환 시스템**: 모험 종료 시 보상 수령 + 결과 모달 표시
- [x] **전투력 밸런스**: 적 파워 테이블, 보스 확률, 레벨별 스케일링
- [x] **레벨업**: 20레벨까지 경험치 테이블, 스탯 자동 상승
- [x] **출발 조건**: 배고픔 80 이상 + HP 80% 이상일 때 자동 출발

### 메타 시스템
- [x] **장비 제작**: 무기/방어구/장신구 9종 레시피, 레벨 잠금 해제
- [x] **장비 강화**: 5단계 강화, 성공률 감소(100%~35%), 강화석+골드 소모
- [x] **요리 시스템**: 5종 음식 레시피, 허기 회복 + HP 회복 + 임시 버프
- [x] **연금술 시스템**: 6종 포션 레시피, 즉발 효과 또는 버프 효과
- [x] **농장 시스템**: 4칸(확장 시 6칸), 7종 작물, 실시간 성장 타이머
- [x] **가챠 시스템**: 특수광석 3개로 랜덤 등급 장비 획득 (일반 60% / 고급 25% / 희귀 12% / 전설 3%)
- [x] **집 배치**: 식탁(음식 5개), 포션 선반(3~5개), 장비대, 책상에 아이템 배치
- [x] **해금 시스템**: 레벨 마일스톤(3/5/8/10/12/15)에 따른 시스템/레시피 해금
- [x] **루트 드롭**: 전투 결과별 재료 드롭 (일반 루트 + 허브 + 씨앗 + 보스 레어)

### UI/비주얼
- [x] **5개 탭 네비게이션**: 집/농장/주방/대장간/연금술
- [x] **상단 상태바**: 골드, 아들 레벨, 현재 상태 표시
- [x] **아들 캐릭터 표시**: 행동별 이모지 + 대사 말풍선
- [x] **모험 패널**: 편지 목록 실시간 표시
- [x] **귀환 결과 모달**: 전투 결과, 보상, 경험치 요약
- [x] **인벤토리 모달**: 재료/장비/음식/포션/책 탭별 조회
- [x] **프로그레스 바**: HP/배고픔/경험치/작물 성장 표시
- [x] **등급 컬러 코딩**: 일반(회색)/고급(초록)/희귀(파랑)/전설(보라)
- [x] **이모지 기반 비주얼**: 모든 에셋을 이모지로 대체

## 아키텍처 결정 사항

### React Context + useReducer 패턴
외부 상태 관리 라이브러리 없이 React 내장 기능만으로 구현했다. `GameProvider`가 전체 게임 상태를 관리하며, `useGameState` 훅으로 어디서든 접근 가능하다. `useGameActions` 훅이 dispatch를 래핑하여 타입 안전한 액션 호출을 제공한다.

### 2초 게임 틱
`setInterval`로 2초마다 `TICK` 액션을 dispatch한다. 매 틱마다 처리 순서:
1. 농장 성장 계산
2. 아들 AI 행동 결정 (집에 있을 때만)
3. 모험 진행 (모험 중일 때만)
4. 레벨업 확인

### localStorage 자동 저장
상태가 변경될 때마다 `useEffect`로 `localStorage`에 JSON 직렬화하여 저장한다. 앱 로드 시 `useReducer` 초기화 함수에서 저장된 상태를 복원한다. 키: `hero-mom-save`.

### 게임 로직 모듈 분리
모든 게임 로직은 순수 함수로 `lib/game/` 하위에 분리했다. Reducer는 액션을 해당 모듈의 함수에 위임만 한다. 각 모듈은 `GameState`를 받아 새 `GameState`를 반환하는 불변 패턴을 따른다 (`structuredClone` 사용).

### 클라이언트 전용 렌더링
Next.js App Router를 사용하지만 서버 컴포넌트는 활용하지 않는다. 게임 로직 전체가 `'use client'`로 클라이언트에서 실행된다. 별도의 API 라우트나 서버 사이드 로직은 없다.

### 페이지 라우팅
Next.js 파일 기반 라우팅 대신, `GameLayout` 컴포넌트 내부에서 상태 기반 탭 전환으로 처리한다. `BottomNav`에서 탭을 선택하면 해당 페이지 컴포넌트를 렌더링한다.

## 알려진 제한 사항
- **이미지 에셋 없음**: 모든 비주얼이 이모지와 CSS로만 표현됨 (나노바나나 API 미사용)
- **전투 시스템 간소화**: 전투가 자동으로 진행되며 결과만 확인 가능, 실시간 전투 인터랙션 없음
- **밸런스 미세조정 미흡**: 레벨 20까지의 수치가 초안 수준, 플레이 테스트 기반 조정 필요
- **반응형 미최적화**: 모바일 우선으로 설계했으나 다양한 화면 크기에 대한 세밀한 대응은 부족
- **사운드/애니메이션 없음**: 프로토타입 범위에서 제외
- **오프라인 진행 없음**: 브라우저를 닫으면 게임 틱이 멈추며, 재접속 시 시간 보정 없음
- **인벤토리 관리 단순화**: 아이템 삭제, 정렬, 일괄 처리 기능 미구현
- **에러 복구 미흡**: localStorage 데이터 손상 시 자동 복구 메커니즘 없음 (리셋만 가능)
